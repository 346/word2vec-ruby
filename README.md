# `word2vec-ruby`

Minor rewrite of, and `ruby` `C`-bindings for, the `distance` program from [`word2vec`](https://code.google.com/archive/p/word2vec/).
This could almost certainly be done with e.g. the [`rb-libsvm`](https://github.com/febeling/rb-libsvm) gem, but this
does so directly.

**N.B.**: This does _not_ currently include bindings for the main `word2vec` program; model creation must be done with
the `C` program. See [the original](https://code.google.com/archive/p/word2vec/) or a
[fork on GitHub](https://github.com/dav/word2vec) for how to do so.


## Installation

Add this line to your application's `Gemfile`:

```ruby
gem 'word2vec-ruby'
```

And then execute:

```bash
bundle install
```

Or install it yourself as:

```bash
gem install word2vec-ruby
```

## Usage

Here we assume you already have a model file generated by `word2vec` (e.g. `vector.bin`); if this is not the case, you
should probably start [here](https://github.com/dav/word2vec).

Assuming the model file is at `data/vector.bin`, the following shows some basic usage patterns:

```ruby
require "word2vec/native_model"

# Load the model file.
model = Word2Vec::NativeModel.parse_file("data/vector.bin")

# Get the index of some word in the model's vocabulary:
model.index("cat")
# => 1980

# Get the nearest neighbors for a word:
model.nearest_neighbors(%w(cat), neighbors_count: 3)
# => { "dog" => 0.7418528199195862, "cats" => 0.711361825466156, "puppy" => 0.6765584349632263 }
```

## Caveats

### String encoding

In the native `C` code, we use [`rb_utf8_str_new_cstr`](https://github.com/ruby/ruby/blob/v2_3_0/string.c#L723-L729)
rather than [`rb_str_new_cstr`](https://github.com/ruby/ruby/blob/v2_3_0/string.c#L708-L713) to create `ruby` strings
from `C` strings (e.g. [here](https://github.com/mnarayan01/word2vec-ruby/blob/v0.1.0/ext/word2vec/native_model.c#L381)
and [here](https://github.com/mnarayan01/word2vec-ruby/blob/v0.1.0/ext/word2vec/native_model.c#L456)). This means that
any strings coming out of (and, to some extent, going into) `Word2Vec::NativeModel` will (should) be marked as having
`Encoding::UTF_8`. We do this, rather than using `Encoding::ASCII_8BIT`, as it is _generally_ more convenient.

If the underlying `word2vec` model file contains strings which are not `UTF-8` encoded, then you should (hopefully?) be
able to use `String#force_encoding` to mark them as the appropriate encoding when they come out of
`Word2Vec::NativeModel`. If this become an issue, then it would be fairly straightforward to add an `#encoding`
attribute to `Word2Vec::Model`, which would default to `Encoding::UTF_8` but could be set to anything else.

## `word2vec` references

Some useful references on `word2vec`:

1.  The [original](https://code.google.com/archive/p/word2vec/). Contains links to relevant academic papers.
2.  A well-written [high level summary of word vectors](http://multithreaded.stitchfix.com/blog/2015/03/11/word-is-worth-a-thousand-vectors/).
3.  [Wikipedia](https://en.wikipedia.org/wiki/Word2vec).
4.  [Deeplearning4j's description](http://deeplearning4j.org/word2vec) of `word2vec`. Java-specific, but still a good
    reference.
5.  A [fork](https://github.com/dav/word2vec) of the original on GitHub.
